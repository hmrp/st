<head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />

      <style>

@media only screen and (min-width: 1px) {
      .pubDesktop {display:none;}
            .pubMobile {display:block;}
    }
    @media only screen and (min-width: 728px) {
      .pubDesktop {display:block}
            .pubMobile {display:none}
    }

    .pubtext {
        content: "Pub";
    display: block;
    margin-top: -0.5rem;
    color: #8a8a8a;
    text-align: right;
    }


    ins[id^="gpt_unit_/4458504"] {z-index:1000!important}
      </style>
</head>




<script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
<!-- <script async src="prebid8.27.0.js"></script> -->
<script async src="prebid.js"></script>


<div class="oop" style="position:fixed; top:0px; left:0; width:1px; height:1px; z-index:80000;"></div>

<div class="pub horz pubDesktop"></div>
<div class="pub horz leaderboard"></div>
<div class="pub horz prebid"></div>
<div class="pub horz pubDesktop"></div>
<div class="pub vert pubDesktop autorefresh prebid"></div>

<!--<div class="pub horz pubMobile"></div>
<div class="pub horz pubDesktop prebid"></div>
<div class="pub horz pubMobile prebid"></div>

<div class="pub horz pubDesktop autorefresh leaderboard"></div>




<div class="pub vert pubDesktop autorefresh prebid"></div>

<div class="pub vert pubDesktop"></div>
<div  class="pub vert pubDesktop prebid"></div>



Mrec / Halfpage
<br>
desktop

<div class="pub vert pubDesktop"></div>
<br><br>
Mobile
<div class="pub vert pubMobile"></div>
-->



<script>
// exemplo logica chamada AD Manager - falta considerar targetings a utilizar e integracao com CMP


window.subSeccaoSite = "opiniao";
dfpSection ="opiniao"
var targetSettings = "noticia";

        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
        var pub = {bid:[],vert:[],horz:[],oop:[],fEnd:[encodeURI(window.location.href.match(/([^\?]*)\/*$/)[0])]},bidTimeout=2000;
        
/* PREBID */
var pbjs = pbjs || {};
pbjs.que = pbjs.que || [];

// Prebid configuration

/* falta ver como Ã© que esta parte funciona.... */
function addAdUnit(code, sizesUsed, customKeyValues) {
  var newAdUnit = {
    code: code,
    mediaTypes: {
      banner: {
    //  sizes: [[300, 250]],
        sizes: sizesUsed,
      },
    },
    bids: [
      {
        bidder: 'appnexus',
        params: {
          placementId: '13232392',
          customParams: customKeyValues
        },
      },
      {
        bidder: 'rubicon',
        params: {
          accountId: 'YOUR_RUBICON_ACCOUNT_ID',
          siteId: 'YOUR_RUBICON_SITE_ID',
          zoneId: 'YOUR_RUBICON_ZONE_ID',
          customParams: {
            customKeyValues
          },
        },
      },
      {
        bidder: 'openx',
        params: {
          unit: 'YOUR_OPENX_UNIT',
          customParams: {
            customKeyValues
          },
        },
      }
    ],
  };

 pub.bid.push(newAdUnit);  
}

// Load Prebid
pbjs.que.push(function () {
  pbjs.addAdUnits(pub.bid);
  pbjs.requestBids({
    bidsBackHandler: initAdServer,
    timeout: pub.bidTimeout,
  });
});

function initAdServer() {
  if (pbjs.initAdserverSet) return;
  pbjs.initAdserverSet = true;
  googletag.cmd.push(function () {
    pbjs.que.push(function () {
      pbjs.setTargetingForGPTAsync();
      googletag.pubads().refresh();
    });
  });
}
/* prebid off */



googletag.cmd.push(function () {
  googletag.pubads()/*
      .setTargeting("assinante", targetAssinante)
      .setTargeting('end', pub.fEnd)
      .setTargeting("noticiatag", targetSettings)
      .setTargeting("Seccao", subSeccaoSite);*/
      .setTargeting("assinante", "nao")
      .setTargeting('end', pub.fEnd)
      .setTargeting("noticiatag", "opiniao")
      .setTargeting("id", "2023121613015767596")
      .setTargeting("category", "internacional") /* motociclismo */
      .setTargeting("type", "article"); /* results, hp, article, section */

  var contador = 0,
  horzSizeMapping = googletag.sizeMapping().addSize([0, 0], [[320, 100], [320, 160],[300, 120], [320, 50], [300, 100], [300, 50], [300,75], [300,50], [234,60],"fluid"]).addSize([768, 200], [[728, 90], [738, 120], [468, 60], "fluid"]).addSize([1024, 200],[[1150, 250], [970, 250], [840, 250], [800, 250], [728, 90], [468, 60], "fluid"]).build(),
  vertSizeMapping = googletag.sizeMapping().addSize([0, 0], [[300, 250], [300, 600], [300, 130], [300, 60], [200, 200], [250, 250], [320,160], [320,50], [320,100], [300,50], [300,100], [300,75],[234,60], [180,150], [125,125],"fluid"]).addSize([768, 200], [[300, 600], [300, 250], [300, 130], [300, 60], [200, 200], [250, 250], [300,50], [300,100], [300,75],[234,60], [180,150], [125,125],"fluid"]).build(),
  targetCLASS = [["prebid"], ["autorefresh"], ["leaderboard"], ["mrec"], ["incontent"]],
  w_sz;

  googletag.pubads().enableLazyLoad({
      fetchMarginPercent: 40,
      renderMarginPercent: 25,
      mobileScaling: 1.3
  });

  function units(className, contador) {
  var targetID, slotDimensions,
  //items = document.getElementsByClassName(className),
  items = document.querySelectorAll("."+className);
    for (var i = 0; i < items.length; i++) {
      if (window.getComputedStyle(items[i]).display != 'none') {
        contador++;
        targetID = className + contador;                            
        items[i].id = targetID;

        function tgt() {
          var x = [];
          for (var i = 0; i < targetCLASS.length; i++) {
            if (document.getElementById(targetID).classList.contains(targetCLASS[i])) {
            x.push(targetCLASS[i]);
            }
          }
          return x.toString();
        };        
        var targeting = tgt();

        if (className == "oop") {
          items[i].id = "oop";
          pub.oop = googletag.defineOutOfPageSlot('/4458504/OOP/' + dfpSection, 'oop').setCollapseEmptyDiv(true, true).setTargeting("end", ["intro"]).addService(googletag.pubads());
        }
        
        if (className == "horz") {
          if (targeting.includes("leaderboard")) {
            var horzTabletSizeMapping = googletag.sizeMapping().addSize([0, 0], [[320, 100], [320, 160],[300, 120], [320, 50], [300, 100], [300, 50], [300,75], [300,50], [234,60], [125,125],"fluid"]).addSize([768, 200], [[728, 90], [738, 120], [468, 60], "fluid"]).addSize([1024, 200],[[728, 90], [468, 60], "fluid"]).build();
            pub.horz[i] = googletag.defineSlot("/4458504/Horz/" + dfpSection,  [[728, 90], [468, 60], [320, 100], [320, 160], [300, 120], [320, 50], [300, 100], [300, 50], [300,75], [300,50], [234,60], "fluid"], "horz" + contador).defineSizeMapping(horzTabletSizeMapping).setTargeting("pos", ["pos"+contador, targeting]).setCollapseEmptyDiv(true, true).addService(googletag.pubads());
          } else {
            pub.horz[i] = googletag.defineSlot("/4458504/Horz/" + dfpSection,  [[1150, 250], [970, 250], [728, 90], [468, 60], [320, 100], [320, 160], [300, 120], [320, 50], [300, 100], [300, 50], [300,75], [300,50], [234,60], "fluid"], "horz" + contador).defineSizeMapping(horzSizeMapping).setTargeting("pos", ["pos"+contador, targeting]).setCollapseEmptyDiv(true, true).addService(googletag.pubads());
            //var slotDimensions = pub.horz[i][1];  
          }
          //slotDimensions = pub.horz[i].getSizes();
          //slotDimensions = pub.horz[i][1];  
          //  console.log(targetID + 'Slot Dimensions: ' + slotDimensions);

            //console.log(targetID + JSON.stringify(slotDimensions));
              
        } 

        if (className == "vert") {
          if (targeting.includes("mrec")) {	
              var vertMrecSizeMapping = googletag.sizeMapping().addSize([0, 0], [[300, 250], [300, 600], [300, 130], [300, 60], [200, 200], [250, 250], [320,160], [320,50], [320,100], [300,50], [300,100], [300,75],[234,60], [180,150], [125,125],"fluid"]).addSize([768, 200], [[300, 600], [300, 130], [300, 60], [200, 200], [250, 250], [300,50], [300,100], [300,75],[234,60], [180,150], [125,125],"fluid"]).build();
             
              pub.vert[i] = googletag.defineSlot("/19968336/prebid_multiformat_test", [[300, 250], [300, 130], [300, 60], [200, 200], [250, 250], [320,50], [320,100], [320,160], [300,50], [300,100], [300,75], [234,60], [180,150], [125,125], "fluid"], "vert" + contador).defineSizeMapping(vertMrecSizeMapping).setTargeting("pos", ["pos"+contador, targeting]).addService(googletag.pubads());

              
          } else {
              pub.vert[i] = googletag.defineSlot("/19968336/prebid_multiformat_test", [[300, 600], [300, 250], [300, 130], [300, 60], [200, 200], [250, 250], [320,50], [320,100], [320,160], [300,50], [300,100], [300,75], [234,60], [180,150], [125,125], "fluid"], "vert" + contador).defineSizeMapping(vertSizeMapping).setTargeting("pos", ["pos"+contador, targeting]).addService(googletag.pubads());


                //    slotDimensions = pub.vert[i][1]; 
             slotDimensions = pub.vert[i].getSizes();
              console.log(targetID + JSON.stringify(slotDimensions));    
          }

        

          //var slotDimensions = [[300, 600], [300, 250], [300, 130], [300, 60], [200, 200], [250, 250], [320,50], [320,100], [320,160], [300,50], [300,100], [300,75], [234,60], [180,150], [125,125], "fluid"];
        } 
        //console.log ("parse? "+ JSON.parse(slotDimensions));
        //console.log ("tostring? "+ slotDimensions.toString());

        if (targeting.includes("prebid")) {
        //addAdUnit("vert" + contador, { pos: 'prebid', pos: 'mrec' });
        console.log(targetID + 'Slot Dimensions: ' + slotDimensions);
        addAdUnit(targetID, slotDimensions, { pos: targeting });
        }
      }
    }
  };
  units("oop", contador);
  units("horz", contador);
  units("vert", contador);
/*
            anchorSlot =  googletag.defineOutOfPageSlot("/4458504/HORZ", googletag.enums.OutOfPageFormat.BOTTOM_ANCHOR);
            if (anchorSlot) {
            anchorSlot
            .setTargeting('end', 'anchor')
             .setTargeting("pos", "anchor")
            .addService(googletag.pubads());
            }


            gaminterstitial =  googletag.defineOutOfPageSlot("/4458504/OOP/Azul/"+ dfpSection, googletag.enums.OutOfPageFormat.INTERSTITIAL);
            if (gaminterstitial) {
            gaminterstitial
             .setTargeting("pos", "gaminterstitial")
            .addService(googletag.pubads()).setConfig({
              interstitial: {
                triggers: {
                  unhideWindow: true,
                },
              },
            });
            }
 

            googletag.pubads().addEventListener("slotOnload", function (event) {
            if (gaminterstitial === event.slot) {
              console.log("Interstitial is loaded.")
            }
          });
 
*/
/*

          googletag.pubads().addEventListener("slotRequested", function (event) {
                var x = event.slot.getAdUnitPath();
                if ((x.indexOf("/Horz") > 4) || (x.indexOf("/Vert") > 4)) {
                    document.getElementById(event.slot.getSlotElementId()).classList.remove("pubtxt", "\u2714");
                }
            });

   
            
                googletag.pubads().addEventListener("slotRenderEnded", function (event) {
                    var x = !event.isEmpty && event.slot;
                    // evitar tambem sobre o anchor e gaminterstitial
                    console.log( document.getElementById(event.slot.getSlotElementId()) );
                    
                    if (x != pub.oop) {
                        
                        document.getElementById(event.slot.getSlotElementId()).classList.add("pubtxt");
                    }
                   
                });
                


                googletag.pubads().addEventListener("impressionViewable", function (event) {
                    if (!event.isEmpty && event.slot != pub.oop) {
                        document.getElementById(event.slot.getSlotElementId()).classList.add("\u2714");
                        if (event.slot.getTargeting("pos").indexOf("autorefresh") >-1 ) {
                            setTimeout(function(){
                                googletag.pubads().refresh([event.slot], {changeCorrelator: true});
                            }, 61000);
                        }
                    }
                });

            */    
  //googletag.disablePublisherConsole();
  googletag.pubads().enableVideoAds();
  googletag.pubads().enableSingleRequest();
  googletag.pubads().enableAsyncRendering();
  googletag.pubads().setCentering(true);
  googletag.pubads().disableInitialLoad();
  googletag.pubads().collapseEmptyDivs(true, true);
  googletag.enableServices();

  function r() {
      //googletag.pubads().refresh()
      initAdServer();
  };
            
               
  (window.pub.cr = function () {
    var x = window.innerWidth;
      if (x <= 767 && w_sz !== 1) {
          w_sz = 1;
        //  console.log("resize 1");
          r();
      }
      if (x >= 768 && x <= 1023 && w_sz !== 2) {
          w_sz = 2;
          // console.log("resize 2");
          r();
      }
      if (x >= 1024 && w_sz !== 3) {
          w_sz = 3;
        //  console.log("resize 3");
          r();
      }
  })();

  window.addEventListener("resize", function () {
    clearTimeout(this.id);
    this.id = setTimeout(pub.cr, 2000);
  });        
});</script>

